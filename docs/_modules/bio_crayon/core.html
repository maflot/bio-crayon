

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>bio_crayon.core &mdash; bio-crayon 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
    <link rel="shortcut icon" href="../../_static/logo_small.png"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            bio-crayon
              <img src="../../_static/logo_small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">bio-crayon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">bio_crayon.core</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for bio_crayon.core</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Core BioCrayon class for managing biological data colormaps.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mcolors</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">load_from_file</span><span class="p">,</span>
    <span class="n">load_from_url</span><span class="p">,</span>
    <span class="n">load_from_dict</span><span class="p">,</span>
    <span class="n">detect_source_type</span><span class="p">,</span>
    <span class="n">hex_to_rgb</span><span class="p">,</span>
    <span class="n">rgb_to_hex</span><span class="p">,</span>
    <span class="n">interpolate_colors</span><span class="p">,</span>
    <span class="n">normalize_color</span><span class="p">,</span>
    <span class="n">interpolate_color_lab</span><span class="p">,</span>
    <span class="n">is_colorblind_safe</span><span class="p">,</span>
    <span class="n">get_colorblind_safe_colors</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.validators</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">validate_colormap_data</span><span class="p">,</span>
    <span class="n">validate_colormap_name</span><span class="p">,</span>
    <span class="n">validate_hex_color</span><span class="p">,</span>
    <span class="n">validate_categorical_colormap</span><span class="p">,</span>
    <span class="n">validate_continuous_colormap</span><span class="p">,</span>
    <span class="n">validate_expression_range</span><span class="p">,</span>
    <span class="n">validate_colorblind_safety</span><span class="p">,</span>
    <span class="n">validate_bio_specific_requirements</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="ColormapAccessor">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.ColormapAccessor">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ColormapAccessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper class to provide intuitive bracket access to colormaps.</span>

<span class="sd">    Allows syntax like: bc[&quot;sex&quot;][&quot;M&quot;] or bc[&quot;sex&quot;].keys()</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ColormapAccessor.__init__">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.ColormapAccessor.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">biocrayon</span><span class="p">:</span> <span class="s2">&quot;BioCrayon&quot;</span><span class="p">,</span> <span class="n">colormap_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">biocrayon</span> <span class="o">=</span> <span class="n">biocrayon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colormap_name</span> <span class="o">=</span> <span class="n">colormap_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span> <span class="o">=</span> <span class="n">biocrayon</span><span class="o">.</span><span class="n">get_colormap</span><span class="p">(</span><span class="n">colormap_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_missing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_color</span> <span class="o">=</span> <span class="s2">&quot;#CCCCCC&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get color for key (category or value).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">biocrayon</span><span class="o">.</span><span class="n">get_color</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colormap_name</span><span class="p">,</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="n">fill_missing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fill_missing</span><span class="p">,</span>
            <span class="n">default_color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_color</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if key exists in colormap.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For continuous, check if value is in range</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">key</span> <span class="o">&lt;=</span> <span class="n">positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="ColormapAccessor.keys">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.ColormapAccessor.keys">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all categories (for categorical colormaps).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;keys() only available for categorical colormaps&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ColormapAccessor.values">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.ColormapAccessor.values">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all colors (for categorical colormaps).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;values() only available for categorical colormaps&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ColormapAccessor.items">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.ColormapAccessor.items">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all category-color pairs (for categorical colormaps).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;items() only available for categorical colormaps&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ColormapAccessor.get">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.ColormapAccessor.get">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get color with default value if key doesn&#39;t exist.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">default</span></div>


<div class="viewcode-block" id="ColormapAccessor.set_fill_missing">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.ColormapAccessor.set_fill_missing">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_fill_missing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">fill_missing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">default_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#CCCCCC&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure whether to automatically assign colors for missing categories.</span>

<span class="sd">        Args:</span>
<span class="sd">            fill_missing: If True, automatically assign colors for missing categories</span>
<span class="sd">            default_color: Default color to use for missing values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_missing</span> <span class="o">=</span> <span class="n">fill_missing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_color</span> <span class="o">=</span> <span class="n">default_color</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">colormap_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">colormap_type</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">fill_status</span> <span class="o">=</span> <span class="s2">&quot; (fill_missing=True)&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_missing</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ColormapAccessor(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">colormap_name</span><span class="si">}</span><span class="s2">&#39;, categories=</span><span class="si">{</span><span class="n">categories</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="n">fill_status</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ColormapAccessor(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">colormap_name</span><span class="si">}</span><span class="s2">&#39;, range=[</span><span class="si">{</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">])&quot;</span>

<div class="viewcode-block" id="ColormapAccessor.to_list">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.ColormapAccessor.to_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to list of colors (for pandas compatibility).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;to_list() only available for categorical colormaps&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ColormapAccessor.to_dict">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.ColormapAccessor.to_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to dictionary mapping categories to colors.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;to_dict() only available for categorical colormaps&quot;</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return number of colors.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over colors (for pandas compatibility).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">])</span></div>



<div class="viewcode-block" id="BioCrayon">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BioCrayon</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main class for managing biological data colormaps.</span>

<span class="sd">    Supports loading colormaps from files, URLs, or dictionaries,</span>
<span class="sd">    and provides methods for accessing and converting colormaps.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="BioCrayon.__init__">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">require_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize BioCrayon with optional source.</span>

<span class="sd">        Args:</span>
<span class="sd">            source: File path, URL, or dictionary containing colormap data</span>
<span class="sd">            require_metadata: Whether metadata is required (True for community colormaps)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;colormaps&quot;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">require_metadata</span><span class="o">=</span><span class="n">require_metadata</span><span class="p">)</span></div>


<div class="viewcode-block" id="BioCrayon.load">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.load">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">require_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load colormap data from source.</span>

<span class="sd">        Args:</span>
<span class="sd">            source: File path, URL, or dictionary containing colormap data</span>
<span class="sd">            require_metadata: Whether metadata is required (True for community colormaps)</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If source is invalid or validation fails</span>
<span class="sd">            FileNotFoundError: If file doesn&#39;t exist</span>
<span class="sd">            requests.RequestException: If URL request fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source_type</span> <span class="o">=</span> <span class="n">detect_source_type</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">source_type</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_file</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">source_type</span> <span class="o">==</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_url</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># dict</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_dict</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

        <span class="c1"># Validate the data</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">validate_colormap_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">require_metadata</span><span class="o">=</span><span class="n">require_metadata</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid colormap data:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>

        <span class="c1"># Store the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;colormaps&quot;</span><span class="p">,</span> <span class="p">{})</span></div>


<div class="viewcode-block" id="BioCrayon.get_colormap">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.get_colormap">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_colormap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a specific colormap by name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the colormap</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary containing colormap data</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If colormap doesn&#39;t exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">:</span>
            <span class="n">available</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Colormap &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found. Available: </span><span class="si">{</span><span class="n">available</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>


<div class="viewcode-block" id="BioCrayon.get_color">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.get_color">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_color</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">colormap_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">key_or_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">fill_missing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">default_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#CCCCCC&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get color for categorical key or continuous value.</span>

<span class="sd">        Args:</span>
<span class="sd">            colormap_name: Name of the colormap</span>
<span class="sd">            key_or_value: Category name (for categorical) or value (for continuous)</span>
<span class="sd">            fill_missing: If True, automatically assign colors for missing categories</span>
<span class="sd">            default_color: Default color to use for missing values (default: &quot;#CCCCCC&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Hex color string</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If colormap doesn&#39;t exist and fill_missing is False</span>
<span class="sd">            ValueError: If value is out of range for continuous colormap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_colormap</span><span class="p">(</span><span class="n">colormap_name</span><span class="p">)</span>
        <span class="n">colormap_type</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">colormap_type</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>

            <span class="c1"># Handle NaN/nan values</span>
            <span class="k">if</span> <span class="n">key_or_value</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;NaN&quot;</span><span class="p">,</span> <span class="s2">&quot;nan&quot;</span><span class="p">,</span> <span class="s2">&quot;NAN&quot;</span><span class="p">,</span> <span class="s2">&quot;Nan&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">default_color</span>

            <span class="c1"># Handle missing categories</span>
            <span class="k">if</span> <span class="n">key_or_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fill_missing</span><span class="p">:</span>
                    <span class="c1"># Auto-assign a color for missing category</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_color_for_missing_category</span><span class="p">(</span>
                        <span class="n">colormap_name</span><span class="p">,</span> <span class="n">key_or_value</span><span class="p">,</span> <span class="n">colors</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">available</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Category &#39;</span><span class="si">{</span><span class="n">key_or_value</span><span class="si">}</span><span class="s2">&#39; not found in colormap &#39;</span><span class="si">{</span><span class="n">colormap_name</span><span class="si">}</span><span class="s2">&#39;. Available: </span><span class="si">{</span><span class="n">available</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
            <span class="k">return</span> <span class="n">colors</span><span class="p">[</span><span class="n">key_or_value</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">colormap_type</span> <span class="o">==</span> <span class="s2">&quot;continuous&quot;</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span>

            <span class="c1"># Handle NaN/nan values for continuous colormaps</span>
            <span class="k">if</span> <span class="n">key_or_value</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;NaN&quot;</span><span class="p">,</span> <span class="s2">&quot;nan&quot;</span><span class="p">,</span> <span class="s2">&quot;NAN&quot;</span><span class="p">,</span> <span class="s2">&quot;Nan&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">default_color</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_or_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Value must be numeric for continuous colormap: </span><span class="si">{</span><span class="n">key_or_value</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">key_or_value</span><span class="p">)</span>

            <span class="c1"># Handle edge cases</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Find the appropriate segment</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="c1"># Interpolate between colors</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">color1</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">color2</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                    <span class="c1"># Simple linear interpolation</span>
                    <span class="n">rgb1</span> <span class="o">=</span> <span class="n">hex_to_rgb</span><span class="p">(</span><span class="n">color1</span><span class="p">)</span>
                    <span class="n">rgb2</span> <span class="o">=</span> <span class="n">hex_to_rgb</span><span class="p">(</span><span class="n">color2</span><span class="p">)</span>

                    <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rgb1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">rgb2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span>
                    <span class="n">g</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rgb1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">rgb2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rgb1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">rgb2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span>

                    <span class="k">return</span> <span class="n">rgb_to_hex</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

            <span class="c1"># Should not reach here</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not interpolate value </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown colormap type: </span><span class="si">{</span><span class="n">colormap_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_assign_color_for_missing_category</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">colormap_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">existing_colors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign a color for a missing category.</span>

<span class="sd">        Args:</span>
<span class="sd">            colormap_name: Name of the colormap</span>
<span class="sd">            category: The missing category</span>
<span class="sd">            existing_colors: Dictionary of existing category-color mappings</span>

<span class="sd">        Returns:</span>
<span class="sd">            Hex color string for the missing category</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get colorblind-safe colors</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_colorblind_safe_colors</span>

        <span class="c1"># Count how many colors we need (existing + 1 for the new category)</span>
        <span class="n">n_needed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_colors</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Get colorblind-safe colors</span>
        <span class="n">safe_colors</span> <span class="o">=</span> <span class="n">get_colorblind_safe_colors</span><span class="p">(</span><span class="n">n_needed</span><span class="p">)</span>

        <span class="c1"># Find the first color that&#39;s not already used</span>
        <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">safe_colors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">color</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_colors</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="c1"># Add the new category-color mapping to the colormap</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">[</span><span class="n">colormap_name</span><span class="p">][</span><span class="s2">&quot;colors&quot;</span><span class="p">][</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
                <span class="k">return</span> <span class="n">color</span>

        <span class="c1"># If all safe colors are used, generate a new one</span>
        <span class="c1"># Use a simple algorithm to generate a distinct color</span>
        <span class="n">used_colors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">existing_colors</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c1"># Try different hues to find a distinct color</span>
        <span class="k">for</span> <span class="n">hue</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>  <span class="c1"># Every 30 degrees</span>
            <span class="c1"># Convert HSV to RGB</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">hsv_to_rgb</span><span class="p">,</span> <span class="n">rgb_to_hex</span>

            <span class="n">rgb</span> <span class="o">=</span> <span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Saturation 0.7, Value 0.8</span>
            <span class="n">new_color</span> <span class="o">=</span> <span class="n">rgb_to_hex</span><span class="p">(</span><span class="o">*</span><span class="n">rgb</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">new_color</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_colors</span><span class="p">:</span>
                <span class="c1"># Add the new category-color mapping to the colormap</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">[</span><span class="n">colormap_name</span><span class="p">][</span><span class="s2">&quot;colors&quot;</span><span class="p">][</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_color</span>
                <span class="k">return</span> <span class="n">new_color</span>

        <span class="c1"># Fallback: use a gray color</span>
        <span class="n">fallback_color</span> <span class="o">=</span> <span class="s2">&quot;#CCCCCC&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">[</span><span class="n">colormap_name</span><span class="p">][</span><span class="s2">&quot;colors&quot;</span><span class="p">][</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">fallback_color</span>
        <span class="k">return</span> <span class="n">fallback_color</span>

<div class="viewcode-block" id="BioCrayon.list_colormaps">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.list_colormaps">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_colormaps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List available colormaps.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of colormap names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<div class="viewcode-block" id="BioCrayon.to_matplotlib">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.to_matplotlib">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_matplotlib</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">colormap_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n_colors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Colormap</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert colormap to matplotlib Colormap object.</span>

<span class="sd">        Args:</span>
<span class="sd">            colormap_name: Name of the colormap</span>
<span class="sd">            n_colors: Number of colors in the matplotlib colormap</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib.colors.Colormap object</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If colormap doesn&#39;t exist</span>
<span class="sd">            ValueError: If colormap type is not supported for matplotlib conversion</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_colormap</span><span class="p">(</span><span class="n">colormap_name</span><span class="p">)</span>
        <span class="n">colormap_type</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">colormap_type</span> <span class="o">==</span> <span class="s2">&quot;continuous&quot;</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span>

            <span class="c1"># Convert hex colors to RGB (0-1 range)</span>
            <span class="n">rgb_colors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
                <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">hex_to_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
                <span class="n">rgb_colors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">r</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="n">g</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">255</span><span class="p">])</span>

            <span class="c1"># Create matplotlib colormap</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
                <span class="n">colormap_name</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">rgb_colors</span><span class="p">)),</span> <span class="n">N</span><span class="o">=</span><span class="n">n_colors</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">cmap</span>

        <span class="k">elif</span> <span class="n">colormap_type</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>

            <span class="c1"># For categorical, create a discrete colormap</span>
            <span class="n">color_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">rgb_colors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">color_list</span><span class="p">:</span>
                <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">hex_to_rgb</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
                <span class="n">rgb_colors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">r</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="n">g</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">255</span><span class="p">])</span>

            <span class="c1"># Create discrete colormap</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">rgb_colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">colormap_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cmap</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot convert colormap type &#39;</span><span class="si">{</span><span class="n">colormap_type</span><span class="si">}</span><span class="s2">&#39; to matplotlib&quot;</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="BioCrayon.add_colormap">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.add_colormap">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_colormap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">colormap_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new colormap.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name for the new colormap</span>
<span class="sd">            colormap_data: Dictionary containing colormap data</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If name is invalid or colormap data is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_colormap_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid colormap name: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Colormap &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>

        <span class="c1"># Validate the colormap data</span>
        <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">colormap_data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Colormap data must have &#39;type&#39; field&quot;</span><span class="p">)</span>

        <span class="n">colormap_type</span> <span class="o">=</span> <span class="n">colormap_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">colormap_type</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">validate_categorical_colormap</span><span class="p">(</span><span class="n">colormap_data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">colormap_type</span> <span class="o">==</span> <span class="s2">&quot;continuous&quot;</span><span class="p">:</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">validate_continuous_colormap</span><span class="p">(</span><span class="n">colormap_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown colormap type: </span><span class="si">{</span><span class="n">colormap_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid colormap data:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>

        <span class="c1"># Add the colormap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">colormap_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;colormaps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span></div>


<div class="viewcode-block" id="BioCrayon.save">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.save">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span> <span class="n">require_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save current colormaps to file.</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath: Path to save the JSON file</span>
<span class="sd">            require_metadata: Whether metadata is required (True for community colormaps)</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If data is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate the complete data structure</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">validate_colormap_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">require_metadata</span><span class="o">=</span><span class="n">require_metadata</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid data structure:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>

        <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="BioCrayon.get_metadata">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.get_metadata">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get metadata about the colormap collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary containing metadata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="BioCrayon.get_colormap_info">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.get_colormap_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_colormap_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get information about a specific colormap.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the colormap</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary containing colormap information</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If colormap doesn&#39;t exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_colormap</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">colormap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;categories&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;num_categories&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># continuous</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;num_colors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;interpolation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colormap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interpolation&quot;</span><span class="p">,</span> <span class="s2">&quot;linear&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="BioCrayon.plot_colormap">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.plot_colormap">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_colormap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a colormap for visualization.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the colormap</span>
<span class="sd">            figsize: Figure size (width, height)</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If colormap doesn&#39;t exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_colormap</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">colormap_type</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">colormap_type</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">color_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

            <span class="c1"># Create color patches</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">color_values</span><span class="p">)):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Categories&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Color&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Categorical Colormap: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">categories</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># continuous</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span>

            <span class="c1"># Create gradient</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">x_start</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">x_end</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">color_start</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">color_end</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Interpolate colors for smooth gradient</span>
                <span class="n">n_steps</span> <span class="o">=</span> <span class="mi">50</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">j</span> <span class="o">/</span> <span class="n">n_steps</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x_start</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_end</span> <span class="o">-</span> <span class="n">x_start</span><span class="p">)</span>

                    <span class="c1"># Interpolate color</span>
                    <span class="n">rgb1</span> <span class="o">=</span> <span class="n">hex_to_rgb</span><span class="p">(</span><span class="n">color_start</span><span class="p">)</span>
                    <span class="n">rgb2</span> <span class="o">=</span> <span class="n">hex_to_rgb</span><span class="p">(</span><span class="n">color_end</span><span class="p">)</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rgb1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">rgb2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">rgb1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">g</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rgb1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">rgb2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rgb1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rgb1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">rgb2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">rgb1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">rgb_to_hex</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="n">x_end</span> <span class="o">-</span> <span class="n">x_start</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_steps</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Position&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Color&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Continuous Colormap: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return number of colormaps.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if colormap exists.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over colormap names.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">colormap_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">ColormapAccessor</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get colormap data for intuitive bracket notation.</span>

<span class="sd">        For categorical colormaps: returns the colors dictionary directly</span>
<span class="sd">        For continuous colormaps: returns a ColormapAccessor object</span>

<span class="sd">        Allows syntax like: bc[&quot;sex&quot;][&quot;M&quot;] or bc[&quot;sex&quot;].keys() for categorical</span>
<span class="sd">        or bc[&quot;expression&quot;][0.5] for continuous</span>

<span class="sd">        Args:</span>
<span class="sd">            colormap_name: Name of the colormap</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary of category-color mappings for categorical colormaps,</span>
<span class="sd">            or ColormapAccessor object for continuous colormaps</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If colormap doesn&#39;t exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">colormap_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">:</span>
            <span class="n">available</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Colormap &#39;</span><span class="si">{</span><span class="n">colormap_name</span><span class="si">}</span><span class="s2">&#39; not found. Available: </span><span class="si">{</span><span class="n">available</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">colormap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">[</span><span class="n">colormap_name</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="c1"># Return the colors dictionary directly for categorical colormaps</span>
            <span class="k">return</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Return ColormapAccessor for continuous colormaps</span>
            <span class="k">return</span> <span class="n">ColormapAccessor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colormap_name</span><span class="p">)</span>

<div class="viewcode-block" id="BioCrayon.validate_expression_range">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.validate_expression_range">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_expression_range</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">colormap_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">min_val</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">max_val</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate that a continuous colormap covers the expected expression range.</span>

<span class="sd">        Args:</span>
<span class="sd">            colormap_name: Name of the colormap to validate</span>
<span class="sd">            min_val: Expected minimum value in the data</span>
<span class="sd">            max_val: Expected maximum value in the data</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of validation error messages (empty if valid)</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If colormap doesn&#39;t exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_colormap</span><span class="p">(</span><span class="n">colormap_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">validate_expression_range</span><span class="p">(</span><span class="n">colormap</span><span class="p">,</span> <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">)</span></div>


<div class="viewcode-block" id="BioCrayon.is_colorblind_safe">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.is_colorblind_safe">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_colorblind_safe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">colormap_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">colorblind_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;deuteranopia&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if categorical colormap is distinguishable for colorblind users.</span>

<span class="sd">        Args:</span>
<span class="sd">            colormap_name: Name of the colormap to check</span>
<span class="sd">            colorblind_type: Type of colorblindness to check for</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if colors are distinguishable for the specified colorblind type</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If colormap doesn&#39;t exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_colormap</span><span class="p">(</span><span class="n">colormap_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Colorblind safety check only applies to categorical colormaps, got </span><span class="si">{</span><span class="n">colormap</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">is_colorblind_safe</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">colorblind_type</span><span class="p">)</span></div>


<div class="viewcode-block" id="BioCrayon.get_colorbar">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.get_colorbar">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_colorbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colormap_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return matplotlib colorbar for the colormap.</span>

<span class="sd">        Args:</span>
<span class="sd">            colormap_name: Name of the colormap</span>
<span class="sd">            **kwargs: Additional arguments passed to matplotlib.colorbar.Colorbar</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib Figure with colorbar</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If colormap doesn&#39;t exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_colormap</span><span class="p">(</span><span class="n">colormap_name</span><span class="p">)</span>
        <span class="n">colormap_type</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

        <span class="c1"># Extract and remove figsize from kwargs if present</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;figsize&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="c1"># Create a simple figure with colorbar</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">colormap_type</span> <span class="o">==</span> <span class="s2">&quot;continuous&quot;</span><span class="p">:</span>
            <span class="c1"># Create a gradient image</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span>

            <span class="c1"># Convert to matplotlib colormap</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_matplotlib</span><span class="p">(</span><span class="n">colormap_name</span><span class="p">)</span>

            <span class="c1"># Create gradient data</span>
            <span class="n">gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

            <span class="c1"># Add colorbar</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colormap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="n">colormap_name</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># categorical</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">color_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

            <span class="c1"># Create discrete colorbar</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_matplotlib</span><span class="p">(</span><span class="n">colormap_name</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Create gradient data</span>
            <span class="n">gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

            <span class="c1"># Add colorbar with category labels</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colormap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="n">colormap_name</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Colorbar: </span><span class="si">{</span><span class="n">colormap_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="BioCrayon.get_color_lab">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.get_color_lab">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_color_lab</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">colormap_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">key_or_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">fill_missing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">default_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;#CCCCCC&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get color using LAB color space interpolation for better perceptual uniformity.</span>

<span class="sd">        Args:</span>
<span class="sd">            colormap_name: Name of the colormap</span>
<span class="sd">            key_or_value: Category name (for categorical) or value (for continuous)</span>
<span class="sd">            fill_missing: If True, automatically assign colors for missing categories</span>
<span class="sd">            default_color: Default color to use for missing values (default: &quot;#CCCCCC&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Hex color string</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If colormap doesn&#39;t exist and fill_missing is False</span>
<span class="sd">            ValueError: If value is out of range for continuous colormap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_colormap</span><span class="p">(</span><span class="n">colormap_name</span><span class="p">)</span>
        <span class="n">colormap_type</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">colormap_type</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>

            <span class="c1"># Handle NaN/nan values</span>
            <span class="k">if</span> <span class="n">key_or_value</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;NaN&quot;</span><span class="p">,</span> <span class="s2">&quot;nan&quot;</span><span class="p">,</span> <span class="s2">&quot;NAN&quot;</span><span class="p">,</span> <span class="s2">&quot;Nan&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">default_color</span>

            <span class="c1"># Handle missing categories</span>
            <span class="k">if</span> <span class="n">key_or_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fill_missing</span><span class="p">:</span>
                    <span class="c1"># Auto-assign a color for missing category</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_color_for_missing_category</span><span class="p">(</span>
                        <span class="n">colormap_name</span><span class="p">,</span> <span class="n">key_or_value</span><span class="p">,</span> <span class="n">colors</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">available</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Category &#39;</span><span class="si">{</span><span class="n">key_or_value</span><span class="si">}</span><span class="s2">&#39; not found in colormap &#39;</span><span class="si">{</span><span class="n">colormap_name</span><span class="si">}</span><span class="s2">&#39;. Available: </span><span class="si">{</span><span class="n">available</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
            <span class="k">return</span> <span class="n">colors</span><span class="p">[</span><span class="n">key_or_value</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">colormap_type</span> <span class="o">==</span> <span class="s2">&quot;continuous&quot;</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span>

            <span class="c1"># Handle NaN/nan values for continuous colormaps</span>
            <span class="k">if</span> <span class="n">key_or_value</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;NaN&quot;</span><span class="p">,</span> <span class="s2">&quot;nan&quot;</span><span class="p">,</span> <span class="s2">&quot;NAN&quot;</span><span class="p">,</span> <span class="s2">&quot;Nan&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">default_color</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_or_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Value must be numeric for continuous colormap: </span><span class="si">{</span><span class="n">key_or_value</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">key_or_value</span><span class="p">)</span>

            <span class="c1"># Handle edge cases</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Find the appropriate segment</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="c1"># Interpolate between colors using LAB space</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">color1</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">color2</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                    <span class="k">return</span> <span class="n">interpolate_color_lab</span><span class="p">(</span><span class="n">color1</span><span class="p">,</span> <span class="n">color2</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

            <span class="c1"># Should not reach here</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not interpolate value </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown colormap type: </span><span class="si">{</span><span class="n">colormap_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="BioCrayon.create_colorblind_safe_colormap">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.create_colorblind_safe_colormap">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_colorblind_safe_colormap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n_colors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">colorblind_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;deuteranopia&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new colorblind-safe categorical colormap.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name for the new colormap</span>
<span class="sd">            n_colors: Number of colors needed</span>
<span class="sd">            colorblind_type: Type of colorblindness to optimize for</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If name is invalid or colormap already exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_colormap_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid colormap name: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Colormap &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>

        <span class="c1"># Get colorblind-safe colors</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">get_colorblind_safe_colors</span><span class="p">(</span><span class="n">n_colors</span><span class="p">,</span> <span class="n">colorblind_type</span><span class="p">)</span>

        <span class="c1"># Create colormap data</span>
        <span class="n">colormap_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;categorical&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Colorblind-safe colormap for </span><span class="si">{</span><span class="n">colorblind_type</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">n_colors</span><span class="si">}</span><span class="s2"> colors)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;colors&quot;</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;category_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">)},</span>
        <span class="p">}</span>

        <span class="c1"># Add the colormap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">colormap_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;colormaps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span></div>


<div class="viewcode-block" id="BioCrayon.validate_bio_requirements">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.validate_bio_requirements">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_bio_requirements</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">colormap_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bio_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;expression&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate colormap against biological data type requirements.</span>

<span class="sd">        Args:</span>
<span class="sd">            colormap_name: Name of the colormap to validate</span>
<span class="sd">            bio_type: Type of biological data (&quot;expression&quot;, &quot;sequence&quot;, &quot;structure&quot;, &quot;pathway&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of validation error messages (empty if valid)</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If colormap doesn&#39;t exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_colormap</span><span class="p">(</span><span class="n">colormap_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">validate_bio_specific_requirements</span><span class="p">(</span><span class="n">colormap</span><span class="p">,</span> <span class="n">bio_type</span><span class="p">)</span></div>


<div class="viewcode-block" id="BioCrayon.from_community">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.from_community">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_community</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BioCrayon&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load colormap from community registry.</span>

<span class="sd">        Args:</span>
<span class="sd">            category: Category of the colormap (e.g., &quot;neuroscience&quot;, &quot;genomics&quot;)</span>
<span class="sd">            name: Name of the colormap file (without .json extension)</span>

<span class="sd">        Returns:</span>
<span class="sd">            BioCrayon instance loaded with the community colormap</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If colormap doesn&#39;t exist in community collection</span>
<span class="sd">            ValueError: If colormap data is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Construct path to community colormap</span>
        <span class="n">community_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;community_colormaps&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">category</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.json&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">community_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">available_categories</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;community_colormaps&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
            <span class="p">]</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Community colormap &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found in category &#39;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Available categories: </span><span class="si">{</span><span class="n">available_categories</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Load the colormap and enforce metadata requirements</span>
        <span class="c1"># Load the colormap and enforce metadata requirements</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">community_path</span><span class="p">,</span> <span class="n">require_metadata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="BioCrayon.list_community_colormaps">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.list_community_colormaps">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_community_colormaps</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List all available community colormaps by category.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary mapping category names to lists of available colormap names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">community_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;community_colormaps&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">community_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="n">categories</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">category_dir</span> <span class="ow">in</span> <span class="n">community_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">category_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="n">category_name</span> <span class="o">=</span> <span class="n">category_dir</span><span class="o">.</span><span class="n">name</span>
                <span class="n">colormaps</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">json_file</span> <span class="ow">in</span> <span class="n">category_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.json&quot;</span><span class="p">):</span>
                    <span class="n">colormaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">json_file</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>
                <span class="n">categories</span><span class="p">[</span><span class="n">category_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">colormaps</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">categories</span></div>


<div class="viewcode-block" id="BioCrayon.contribute_colormap">
<a class="viewcode-back" href="../../api.html#bio_crayon.core.BioCrayon.contribute_colormap">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">contribute_colormap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to format colormap for community contribution.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name for the colormap</span>
<span class="sd">            category: Category for the colormap</span>
<span class="sd">            metadata: Additional metadata for the contribution</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with contribution information and formatted colormap data</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If colormap doesn&#39;t exist or metadata is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Colormap &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found in current instance&quot;</span><span class="p">)</span>

        <span class="n">colormap_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colormaps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Add contribution metadata</span>
        <span class="n">contribution_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
            <span class="s2">&quot;contribution_date&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contribution_date&quot;</span><span class="p">),</span>
            <span class="s2">&quot;contributor&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contributor&quot;</span><span class="p">),</span>
            <span class="s2">&quot;paper_reference&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;paper_reference&quot;</span><span class="p">),</span>
            <span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;doi&quot;</span><span class="p">),</span>
            <span class="s2">&quot;use_case&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;use_case&quot;</span><span class="p">),</span>
            <span class="s2">&quot;accessibility_tested&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;accessibility_tested&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="s2">&quot;example_provided&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;example_provided&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Validate accessibility if categorical</span>
        <span class="k">if</span> <span class="n">colormap_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colormap_data</span><span class="p">[</span><span class="s2">&quot;colors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">contribution_info</span><span class="p">[</span><span class="s2">&quot;colorblind_safe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_colorblind_safe</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;colormap_data&quot;</span><span class="p">:</span> <span class="n">colormap_data</span><span class="p">,</span>
            <span class="s2">&quot;contribution_info&quot;</span><span class="p">:</span> <span class="n">contribution_info</span><span class="p">,</span>
            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;community_colormaps/</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">,</span>
        <span class="p">}</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Matthias Flotho.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>